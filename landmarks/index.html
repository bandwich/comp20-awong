<!DOCTYPE html>

<html>
<head>
	<title>Map</title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<meta charset="utf-8">
	<script async defer 
		type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true"></script>
	<link rel="stylesheet" href="style.css" />

	<script>
		var currentLat = 0;
		var currentLong = 0;
		var map;
		var myMarker;
		var myLoc;

		function initMap() {
			navigator.geolocation.getCurrentPosition(function(pos) {
				currentLat = pos.coords.latitude;
				currentLong = pos.coords.longitude;
				myLoc = new google.maps.LatLng(currentLat, currentLong);
				map = new google.maps.Map(document.getElementById('map'), {center: myLoc, zoom:16});
				getData(currentLat, currentLong);
				addMarker();
			});
		}
		function addMarker() {
			myMarker = new google.maps.Marker({
				position: myLoc,
				map: map,
				title: "My location"
			});
			var loginWindow = new google.maps.InfoWindow({
				content: "Username: 58ijDq5h"
			});
			google.maps.event.addListener(myMarker, 'click', function() {
				loginWindow.open(map, myMarker)
			});
		}

		var dataReq = new XMLHttpRequest();
		function getData(lat, long) {
			dataReq.open("POST", "https://defense-in-derpth.herokuapp.com/sendLocation", true);
			dataReq.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			dataReq.onreadystatechange = function() {
				if (dataReq.readyState == 4 && dataReq.status == 200) {
					data = dataReq.responseText;
					locs = JSON.parse(data);
					console.log(locs);
				}
				else if (dataReq.readyState == 4 && dataRequest.status != 200)
					console.log("Failed");
				else console.log("Wait");
			};
			var parameters = "login=58ijDq5h" + "&" + "lat=" + lat + "&" + "lng=" + long;
			dataReq.send(parameters);
		}
	</script>
</head>
<body onload="initMap()">
	<div id="map"></div>
</body>
</html>